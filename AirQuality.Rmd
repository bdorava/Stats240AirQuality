---
title: "New"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = TRUE,
                      error = TRUE)
library(readxl)
library(tidyverse)
library(lubridate)
library(viridisLite)
```

```{r, include=FALSE}
buoy_data = read_table("2021Buoy.txt") %>% 
  full_join(read_table("2022Buoy.txt")) %>% #Join both years of buoy data
  rename(year = "#YY",
         month = "MM",
         day = "DD",
         hour = "hh",
         minute = "mm",
         wspeed = "WSPD",
         wdir = "WDIR",
         atemp = "ATMP",
         wtemp = "WTMP") %>% #Rename columns
  select(year, month, day, hour, minute, wspeed, wdir, atemp, wtemp) %>% #Select useful columns
  filter(year != "#yr") %>% #Remove padding
  mutate(wdir = case_when(wdir != "999" ~ wdir, .default = NA),
         wspeed = case_when(wspeed != "99.0" ~ wspeed, .default = NA),
         atemp = case_when(atemp != "999.0" ~ atemp, .default = NA),
         wtemp = case_when(wtemp != "999.0" ~ wtemp, .default = NA)) %>% #Convert missing values to NA
  mutate(timestamp = ymd_hm(str_c(year, month, day, hour, minute))) %>% #Create timestamp
  mutate(wspeed = as.numeric(wspeed),
         wdir = as.integer(wdir),
         atemp = as.numeric(atemp),
         wtemp = as.numeric(wtemp)) %>% #Convert types
  mutate(source = "water")
```

```{r, include=FALSE}
ground_data = read_excel("2021Chiwaukee.xls", skip=2) %>% 
  full_join(read_excel("2022Chiwaukee.xlsx", skip=2)) %>% #Join both years of air quality data
  rename(timestamp = "Monitor Name", 
         ozone = "OZONE",
         atemp = "T_OUTDOOR",
         wspeed = "WIND SPEED - R", 
         wdir = "WIND DIRECTION - R",
         precip = "RAIN/MELT PCPT",
         solar = "SOLAR RADIATION",
         pm25 = "PM2.5 - LC",
         noy = "NOy",
         co = "CARBON MONOXIDE") %>% #Rename columns
  select(timestamp, ozone, atemp, wspeed,
         wdir, precip, solar, pm25, noy, co) %>% #Select useful columns
  filter(timestamp != "Units" &
         timestamp != "Parameter Code | POC" &
         timestamp != "Tag Number" &
         timestamp != "Minimum" &
         timestamp != "MinDate" &
         timestamp != "Maximum" &
         timestamp != "MaxDate" &
         timestamp != "Avg" &
         timestamp != "Num" &
         timestamp != "Data[%]" &
         timestamp != "STD") %>% #Remove Padding
  mutate(.,
         ozone = case_when(str_detect(.$ozone, "[A-Za-z]") ~ NA,
                                     .default = ozone),
         atemp = case_when(str_detect(.$atemp, "[A-Za-z]") ~ NA,
                                     .default = atemp),
         wspeed = case_when(str_detect(.$wspeed, "[A-Za-z]") ~ NA,
                                     .default = wspeed),
         wdir = case_when(str_detect(.$wdir, "[A-Za-z]") ~ NA,
                                     .default = wdir),
         precip = case_when(str_detect(.$precip, "[A-Za-z]") ~ NA,
                                     .default = precip),
         solar = case_when(str_detect(.$solar, "[A-Za-z]") ~ NA,
                                     .default = solar),
         pm25 = case_when(str_detect(.$pm25, "[A-Za-z]") ~ NA,
                                     .default = pm25),
         noy = case_when(str_detect(.$noy, "[A-Za-z]") ~ NA,
                                     .default = noy),
         co = case_when(str_detect(.$co, "[A-Za-z]") ~ NA,
                                     .default = co)) %>% #Remove missing values
  mutate(timestamp = mdy_hm(timestamp),
         ozone = round(as.numeric(ozone), 1),
         atemp = round(as.numeric(atemp), 1),
         wspeed = round(as.numeric(wspeed), 1),
         wdir = round(as.integer(wdir)),
         precip = round(as.numeric(precip), 1),
         solar = round(as.numeric(solar), 1),
         pm25 = round(as.numeric(pm25), 1),
         noy = round(as.numeric(noy), 1),
         co = round(as.numeric(co), 3)) %>% #Convert types
  mutate(atemp = (atemp - 32) / 1.8, wspeed = wspeed * 1609.344 / 3600) %>% #Convert to metric
  mutate(source = "ground") #Add source tag
```

```{r, include=FALSE}
mixed_data = full_join(ground_data, buoy_data) %>%
  mutate(year = year(timestamp),
         month = month(timestamp, label = TRUE),
         wday = wday(timestamp, label = TRUE), 
         day = day(timestamp),
         hour = hour(timestamp),
         minute = minute(timestamp)) %>% 
  #Convert values less than 0 to 0
  #mutate(noy = case_when(noy < 0 ~ 0)) %>%
  mutate(u = round(-wspeed * sin(wdir*2*pi/360), 2),
         v = round(-wspeed * cos(wdir*2*pi/360), 2)) %>% #Determine components of 2-D flow, from wdir
  mutate(air_water_temp_difference = atemp - wtemp)
```

<p>Introduction</p>

<p>The opening sentence or sentences should draw the reader into your report by providing high-level motivation for the analysis.</p>

<p>Describe the question or questions of interest and the motivation for the analysis.</p>

<p>Conclude the introduction with a thesis statement.</p>

<p>A thesis statement comprises one or two declarative sentences that summarize the main point of the report and clearly makes an assertion and communicates to the reader the position the authors have taken on the topic.1Links to an external site.</p>

<p>Background</p>

<p>Describe the data set, how it was collected, what the variables mean.</p>

<p>Cite the source of your data.</p>

<p>Describe any background information needed to better comprehend the question or questions you are posing and how the data relate to the question.</p>

<p>Describe any unusual factors which may affect interpretation of results.</p>

<p>Describe what you intend to do in the rest of the report.</p>

<p>Analysis</p>

<p>Include numerical and graphical summaries of the data. Be sure to introduce and describe your numerical and graphical summaries. Do not display a series of summaries without text explaining them.</p>

<p>Make sure to include at least one graphical display of the data that best supports your main conclusions for your primary question, and explain how it supports your conclusions.</p>

<p>For each inference you make, briefly describe the method you use and what the results are.</p>

<p>Provide evidence to support each of your claims.</p>

<p>This section should not include substantial interpretation of results. Leave that for the discussion.</p>

<p>Discussion</p>

<p>Provide broader interpretations of your analysis and describe how to interpret your results with respect to your question of interest.</p>

<p>Discuss any potential short-comings of the analysis.</p>

<p>Discuss potential future directions for additional work</p>

<p>New questions</p>

<p>Different methods to address the same questions</p>

<p>New data you might collect to refine your understanding</p>

<p>Summarize your primary conclusions and the primary evidence that supports these conclusions.</p>

<p>References</p>

<p>In the R Markdown file, you may automatically cite other resources by using a caret followed by the reference between square brackets: ^[your reference text] which will place a marker at this location and a footnote at the end of the document.</p>

```{r}
buoy_data %>%
  ggplot(aes(x = day, y = wtemp)) + geom_violin() + facet_grid(vars(month), vars(year), scales = "free")
```

```{r}
mixed_data %>%
  ggplot(aes(x = day, y = u, color = air_water_temp_difference)) + geom_point() + facet_grid(vars(month), vars(year), scales = "free") + scale_color_viridis_c(direction = -1)
```
```{r}
mixed_data %>%
  filter(month == "Aug" & day <= 7) %>%
  ggplot(aes(x = hour, y = solar, color = wday)) + geom_smooth() + geom_point() + facet_grid(vars(year), scales = "free") + scale_color_viridis_d(direction = -1, option = "D")
```
```{r}
mixed_data %>%
  filter(month == "Jun" & year == "2021") %>%
  ggplot(aes(x = day, y = u, color = ozone)) + geom_point() + scale_color_viridis_c()
```

